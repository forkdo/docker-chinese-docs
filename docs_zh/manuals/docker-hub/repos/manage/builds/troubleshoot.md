---
title: 自动构建故障排除
description: 如何排除自动构建问题
keywords: docker hub, 故障排除, 自动构建, autobuilds
tags: [ 故障排除 ]
linkTitle: 故障排除
aliases:
- /docker-hub/builds/troubleshoot/
---

> [!NOTE]
>
> 自动构建需要
> Docker Pro、Team 或 Business 订阅。

## 构建失败

如果构建失败，在 **General** 和 **Builds** 选项卡上，构建报告行旁边会显示一个 **重试** 图标。**构建报告** 页面和 **时间线日志** 也会显示一个 **重试** 按钮。

![显示重试构建按钮的时间线视图](images/retry-build.png)

> [!NOTE]
>
> 如果您查看的是属于组织的仓库的构建详情，只有当您对该仓库具有 `读写` 权限时，**取消** 和 **重试** 按钮才会显示。

自动构建有 4 小时的执行时间限制。如果构建达到此时间限制，它将被自动取消，构建日志中会显示以下消息：

```text
2022-11-02T17:42:27Z 构建被取消或超过了最大执行时间。
```

此日志消息与您主动取消构建时相同。要确定构建是否被自动取消，请检查构建持续时间。


## 构建包含链接私有子模块的仓库

Docker Hub 在您的源代码仓库中设置了一个部署密钥，允许它克隆仓库并进行构建。此密钥仅对特定的单个代码仓库有效。如果您的源代码仓库使用私有 Git 子模块，或需要克隆其他私有仓库才能构建，Docker Hub 无法访问这些额外的仓库，构建无法完成，并且在构建时间线中记录错误。

要解决此问题，您可以使用 `SSH_PRIVATE` 环境变量来覆盖部署密钥，并授予 Docker Hub 构建系统对仓库的访问权限。

> [!NOTE]
>
> 如果您使用的是团队自动构建，请改用以下流程，并为您的源代码提供商配置服务用户。您也可以对个人账户执行此操作，以限制 Docker Hub 对您的源代码仓库的访问。

1. 仅用于构建的 SSH 密钥对，并将公钥添加到您的源代码提供商账户中。

    此步骤是可选的，但允许您撤销仅用于构建的密钥对，而不会移除其他访问权限。

2. 将密钥对的私钥部分复制到剪贴板。
3. 在 Docker Hub 中，导航到具有链接私有子模块的仓库的构建页面。（如有必要，请[按照此处的步骤](index.md#configure-automated-builds)配置自动构建。）
4. 在屏幕底部，选择 **构建环境变量** 旁边的 **加号** 图标。
5. 输入 `SSH_PRIVATE` 作为新环境变量的名称。
6. 将密钥对的私钥部分粘贴到 **值** 字段中。
7. 选择 **保存**，或 **保存并构建** 以验证构建现在可以完成。

> [!NOTE]
>
> 您必须使用 git over SSH（`git@submodule.tld:some-submodule.git`）而不是 HTTPS 来配置您的私有 git 子模块。