---
title: 基础镜像加固
linktitle: 加固
description: 了解 Docker Hardened Images 如何通过最小化组件、非 root 执行和默认安全配置来实现安全性。
keywords: 加固基础镜像, 最小容器镜像, 非 root 容器, 安全容器配置, 移除包管理器
---

## 什么是基础镜像加固？

基础镜像加固是通过最小化镜像包含的内容并采用安全优先的默认配置来保护容器镜像基础层的过程。加固的基础镜像会移除不必要的组件，如 shell、编译器和包管理器，从而限制可用的攻击面，使攻击者更难控制容器或提升权限。

加固还包括应用最佳实践，如以非 root 用户运行、减少可写入区域，以及通过不可变性确保一致性。虽然 [Docker 官方镜像](../../docker-hub/image-library/trusted-content.md#docker-official-images) 和 [Docker 验证发布者镜像](../../docker-hub/image-library/trusted-content.md#verified-publisher-images) 遵循安全最佳实践，但它们可能不如 Docker Hardened Images 那样加固，因为它们的设计需要支持更广泛的用例。

## 为什么它很重要？

大多数容器的安全态势继承自其使用的基础镜像。如果基础镜像包含不必要的工具或以提升的权限运行，那么在其之上构建的每个容器都会面临这些风险。

加固基础镜像可以：

- 通过移除可能被利用的工具和库来减少攻击面
- 通过放弃 root 访问权限和限制容器能力来强制实施最小权限原则
- 通过避免运行时更改和漂移来提高可靠性和一致性
- 符合安全软件供应链实践并有助于满足合规标准

使用加固的基础镜像是保护您在容器中构建和运行的软件的关键第一步。

## 移除了什么以及原因

加固镜像通常会排除在安全生产环境中风险较高或不必要的常见组件：

| 移除的组件                                       | 原因                                                                             |
|--------------------------------------------------|----------------------------------------------------------------------------------|
| Shell（例如 `sh`, `bash`）                       | 防止用户或攻击者在容器内执行任意命令                                             |
| 包管理器（例如 `apt`, `apk`）                    | 禁止在构建后安装软件，减少漂移和暴露                                               |
| 编译器和解释器                                   | 避免引入可能用于运行或注入恶意代码的工具                                           |
| 调试工具（例如 `strace`, `curl`, `wget`）        | 降低利用或信息泄露的风险                                                           |
| 未使用的库或区域设置                             | 减小镜像大小并最小化攻击向量                                                     |

## Docker Hardened Images 如何应用基础镜像加固

Docker Hardened Images (DHIs) 通过设计应用基础镜像加固原则。每个镜像都构建为仅包含其特定用途所需的组件，无论是构建应用（使用 `-dev` 或 `-sdk` 标签）还是在生产环境中运行它们。

### Docker Hardened Image 特性

Docker Hardened Images 旨在：

- 最小化：仅包含必要的库和二进制文件
- 不可变：镜像在构建时固定——不允许运行时安装
- 默认非 root：除非另行配置，容器以非特权用户身份运行
- 目的明确：为开发（`-dev`）、基于 SDK 的构建（`-sdk`）和生产运行时提供不同的标签

这些特性有助于在开发、测试和生产环境中强制实施一致、安全的行为。

### Docker Hardened Image 兼容性注意事项

由于 Docker Hardened Images 移除了许多常见工具，它们可能无法开箱即用地适用于所有用例。您可能需要：

- 使用多阶段构建在 `-dev` 镜像中编译代码或安装依赖项，并将输出复制到加固的运行时镜像中
- 用等效的入口点二进制文件替换 shell 脚本，或在需要时显式包含 shell
- 使用 [Docker Debug](../../../reference/cli/docker/debug.md) 临时检查或排查容器问题，而不修改基础镜像

这些权衡是故意的，有助于支持构建安全、可重现且适合生产的容器的最佳实践。