---
title: Docker Engine 17.06 发布说明
linkTitle: Engine v17.06
toc_min: 1
toc_max: 2
---

## 17.06.2-ce
2017-09-05

### 客户端

- 启用客户端的 TCP keepalive 以防止连接丢失 [docker/cli#415](https://github.com/docker/cli/pull/415)

### 运行时

- Devmapper：确保在调用 setCookie 后调用 UdevWait [moby/moby#33732](https://github.com/moby/moby/pull/33732)
- Aufs：确保正确移除 diff 层以防止残留文件占用存储空间 [moby/moby#34587](https://github.com/moby/moby/pull/34587)

### Swarm 模式

- 忽略正在运行任务的 PullOptions [docker/swarmkit#2351](https://github.com/docker/swarmkit/pull/2351)

## 17.06.1-ce
2017-08-15

### 构建器

* 修复一个回归问题，其中 `ADD` 从远程 URL 提取归档文件 [#89](https://github.com/docker/docker-ce/pull/89)
* 修复对远程 "git@" 表示法的处理 [#100](https://github.com/docker/docker-ce/pull/100)
* 修复 copy `--from` 与强制拉取的冲突 [#86](https://github.com/docker/docker-ce/pull/86)

### 客户端

* 在运行 `docker system prune` 时可选是否清理卷，并添加 `--volumes` 标志 [#109](https://github.com/docker/docker-ce/pull/109)
* 在任务被分配之前显示复制任务的进度 [#97](https://github.com/docker/docker-ce/pull/97)
* 修复如果容器不存在时 `docker wait` 挂起的问题 [#106](https://github.com/docker/docker-ce/pull/106)
* 如果 `docker swarm ca` 在没有 `--rotate` 标志的情况下调用，当传入其他标志时发出警告 [#110](https://github.com/docker/docker-ce/pull/110)
* 修复当守护进程返回错误时 API 版本协商不工作的问题 [#115](https://github.com/docker/docker-ce/pull/115)
* 如果在系统清理中将 "until" 过滤器与 "--volumes" 结合使用，则打印错误 [#154](https://github.com/docker/docker-ce/pull/154)

### 日志

* 修复 `journald` 和 `syslog` 的 stderr 日志记录 [#95](https://github.com/docker/docker-ce/pull/95)
* 修复日志读取器可能无限阻塞写入的问题 [#98](https://github.com/docker/docker-ce/pull/98)
* 修复 `awslogs` 驱动程序重复最后一个事件的问题 [#151](https://github.com/docker/docker-ce/pull/151)

### 网络

* 修复驱动选项未被网络驱动接收的问题 [#127](https://github.com/docker/docker-ce/pull/127)

### 插件

* 使插件移除对失败更具弹性 [#91](https://github.com/docker/docker-ce/pull/91)

### 运行时

* 防止 `healthcheck` 停止时发生 `goroutine` 泄漏 [#90](https://github.com/docker/docker-ce/pull/90)
* 在不支持重新标记时不要报错 [#92](https://github.com/docker/docker-ce/pull/92)
* 将 GRPC 连接的最大退避延迟限制为 2 秒 [#94](https://github.com/docker/docker-ce/pull/94)
* 修复由于某些内核中的错误导致在指定内存 cgroup 时容器无法运行的问题 [#102](https://github.com/docker/docker-ce/pull/102)
* 修复暂停的容器不响应 SIGKILL 的问题 [#102](https://github.com/docker/docker-ce/pull/102)
* 改进加载不兼容操作系统镜像时的错误消息 [#108](https://github.com/docker/docker-ce/pull/108)
* 修复 `go-winio` 中的句柄泄漏问题 [#112](https://github.com/docker/docker-ce/pull/112)
* 修复升级时的问题，当启用 `--live-restore` 时阻止 Docker 显示正在运行的容器 [#117](https://github.com/docker/docker-ce/pull/117)
* 修复使用密钥的服务在使用 `userns-remap` 功能的守护进程上无法启动的错误 [#121](https://github.com/docker/docker-ce/pull/121)
* 修复移除时对 `not-exist` 错误的错误处理 [#142](https://github.com/docker/docker-ce/pull/142)
* 修复 REST API Swagger 表示无法用 SwaggerUI 加载的问题 [#156](https://github.com/docker/docker-ce/pull/156)

### 安全

* 在密钥创建时隐藏密钥数据 [#99](https://github.com/docker/docker-ce/pull/99)

### Swarm 模式

* 不要向服务规范添加重复的平台信息 [#107](https://github.com/docker/docker-ce/pull/107)
* 集群更新和内存问题修复 [#114](https://github.com/docker/docker-ce/pull/114)
* 更改网络请求以在 Swarm 中返回预定义网络 [#150](https://github.com/docker/docker-ce/pull/150)

## 17.06.0-ce
2017-06-28

> [!NOTE]: Docker 17.06.0 在镜像构建器中存在一个问题，导致 Dockerfile 中的 `ADD` 指令在引用远程 `.tar.gz` 文件时行为发生变化。该问题将在 Docker 17.06.1 中修复。

> [!NOTE]: 从 Docker CE 17.06 开始，Ubuntu 包也可用于使用 s390x 架构的 IBM Z。

> [!NOTE]: Docker 17.06 默认禁用与传统（v1）注册表的通信。如果您需要与尚未迁移到 v2 协议的注册表交互，请设置 `--disable-legacy-registry=false` 守护进程选项。与 v1 注册表的交互将在 Docker 17.12 中移除。

### 构建器

+ 添加 `--iidfile` 选项到 docker build。它允许指定保存结果镜像 ID 的位置
+ 允许在 git 检出 URL 中指定任何远程引用 [#32502](https://github.com/moby/moby/pull/32502)

### 客户端

+ 为 `docker stack ls` 添加 `--format` 选项 [#31557](https://github.com/moby/moby/pull/31557)
+ 在 compose 启动的构建中添加对标签的支持 [#32632](https://github.com/moby/moby/pull/32632) [#32972](https://github.com/moby/moby/pull/32972)
+ 为 `docker history` 添加 `--format` 选项 [#30962](https://github.com/moby/moby/pull/30962)
+ 为 `docker system df` 添加 `--format` 选项 [#31482](https://github.com/moby/moby/pull/31482)
+ 允许在堆栈文件中指定 Nameservers 和 Search Domains [#32059](https://github.com/moby/moby/pull/32059)
+ 为 `docker stack deploy` 添加对 `read_only` 服务的支持 [#docker/cli/73](https://github.com/docker/cli/pull/73)
* 显示 Swarm 集群和节点 TLS 信息 [#docker/cli/44](https://github.com/docker/cli/pull/44)
+ 为 `docker stack deploy` 添加对放置偏好的支持 [#docker/cli/35](https://github.com/docker/cli/pull/35)
+ 为 `docker swarm` 添加新的 `ca` 子命令以允许管理 Swarm CA [#docker/cli/48](https://github.com/docker/cli/pull/48)
+ 为 compose 添加 credential-spec [#docker/cli/71](https://github.com/docker/cli/pull/71)
+ 为 `--network` 和 `--network-add` 添加 csv 格式选项支持 [#docker/cli/62](https://github.com/docker/cli/pull/62) [#33130](https://github.com/moby/moby/pull/33130)
- 修复 Windows 上堆栈 compose 绑定挂载卷的问题 [#docker/cli/136](https://github.com/docker/cli/pull/136)
- 正确处理没有注册表信息的 Docker 守护进程 [#docker/cli/126](https://github.com/docker/cli/pull/126)
+ 允许在使用 --rollback 时使用 `--detach` 和 `--quiet` 标志 [#docker/cli/144](https://github.com/docker/cli/pull/144)
+ 从 `docker login` 中移除已弃用的 `--email` 标志 [#docker/cli/143](https://github.com/docker/cli/pull/143)
* 调整 `docker stats` 内存输出 [#docker/cli/80](https://github.com/docker/cli/pull/80)

### 分发

* 当同时提供摘要和标签时，在拉取期间选择摘要 [#33214](https://github.com/moby/moby/pull/33214)

### 日志

+ 为 GCP 日志驱动添加监控资源类型元数据 [#32930](https://github.com/moby/moby/pull/32930)
+ 为 AWS CloudWatch 日志驱动添加多行处理 [#30891](https://github.com/moby/moby/pull/30891)

### 网络

+ 添加对使用节点本地网络（如 macvlan、ipvlan、bridge、host）的 Swarm 模式服务的支持 [#32981](https://github.com/moby/moby/pull/32981)
+ 在服务创建时将驱动选项传递给网络驱动 [#32981](https://github.com/moby/moby/pull/33130)
+ 使用 --data-path-addr 将 Swarm 控制平面流量与应用数据流量隔离 [#32717](https://github.com/moby/moby/pull/32717)
* 对服务发现的多项改进 [#docker/libnetwork/1796](https://github.com/docker/libnetwork/pull/1796)

### 打包

+ 在 CentOS/Fedora/RHEL 上可用时依赖 `container-selinux` [#32437](https://github.com/moby/moby/pull/32437)

### 运行时

+ 添加构建和引擎信息的 Prometheus 指标 [#32792](https://github.com/moby/moby/pull/32792)
* 将 containerd 更新到 d24f39e203aa6be4944f06dd0fe38a618a36c764 [#33007](https://github.com/moby/moby/pull/33007)
* 将 runc 更新到 992a5be178a62e026f4069f443c6164912adbf09 [#33007](https://github.com/moby/moby/pull/33007)
+ 添加自动配置 devmapper 的 blkdev 选项 [#31104](https://github.com/moby/moby/pull/31104)
+ 将日志驱动列表添加到 `docker info` [#32540](https://github.com/moby/moby/pull/32540)
+ 添加 API 端点以允许检索镜像清单 [#32061](https://github.com/moby/moby/pull/32061)
* 当 `forceremove` 出现错误时不要从内存中移除容器 [#31012](https://github.com/moby/moby/pull/31012)
+ 添加对指标插件的支持 [#32874](https://github.com/moby/moby/pull/32874)
* 当给 `prune` 命令提供无效过滤器时返回错误 [#33023](https://github.com/moby/moby/pull/33023)
+ 添加守护进程选项以允许推送外部层 [#33151](https://github.com/moby/moby/pull/33151)
- 修复阻止 containerd 在死亡后重启的问题 [#32986](https://github.com/moby/moby/pull/32986)
+ 将集群事件添加到 Docker 事件流 [#32421](https://github.com/moby/moby/pull/32421)
+ 添加对 Windows 上 DNS 搜索的支持 [#33311](https://github.com/moby/moby/pull/33311)
* 升级到 Go 1.8.3 [#33387](https://github.com/moby/moby/pull/33387)
- 防止 journald 重启时 containerd 崩溃 [#containerd/930](https://github.com/containerd/containerd/pull/930)
- 修复由于无效环境变量导致的健康检查失败 [#33249](https://github.com/moby/moby/pull/33249)
- 防止在容器挂载目录时在关闭期间重启容器时在守护进程套接字位置创建目录 [#30348](https://github.com/moby/moby/pull/33330)
- 如果容器的停止信号设置为 `SIGKILL`，则防止容器在停止时重启 [#33335](https://github.com/moby/moby/pull/33335)
- 确保日志驱动程序将相同的文件名传递给 StartLogging 和 StopLogging 端点 [#33583](https://github.com/moby/moby/pull/33583)
- 移除 `SIGUSR1` 上的守护进程数据结构转储以避免恐慌 [#33598](https://github.com/moby/moby/pull/33598)

### 安全

+ 允许在默认 seccomp 配置文件中设置 UNAME26 位的人格特性 [#32965](https://github.com/moby/moby/pull/32965)

### Swarm 模式

+ 添加选项以允许为数据流量（相对于控制流量）指定不同的接口 [#32717](https://github.com/moby/moby/pull/32717)
* 允许在容器内指定密钥位置 [#32571](https://github.com/moby/moby/pull/32571)
+ 添加对 Windows 上密钥的支持 [#32208](https://github.com/moby/moby/pull/32208)
+ 将 TLS 信息添加到 swarm 信息和节点信息端点 [#32875](https://github.com/moby/moby/pull/32875)
+ 添加对服务携带任意配置对象的支持 [#32336](https://github.com/moby/moby/pull/32336), [#docker/cli/45](https://github.com/docker/cli/pull/45), [#33169](https://github.com/moby/moby/pull/33169)
+ 添加 API 以轮换 swarm CA 证书 [#32993](https://github.com/moby/moby/pull/32993)
* 服务摘要固定现在在客户端处理 [#32388](https://github.com/moby/moby/pull/32388), [#33239](https://github.com/moby/moby/pull/33239)
+ 放置现在也考虑平台 [#33144](https://github.com/moby/moby/pull/33144)
- 修复连接失败时可能的挂起问题 [#docker-ce/19](https://github.com/docker/docker-ce/pull/19)
- 修复阻止外部 CA 被接受的问题 [#33341](https://github.com/moby/moby/pull/33341)
- 修复混合版本集群中可能的编排恐慌 [#swarmkit/2233](https://github.com/docker/swarmkit/pull/2233)
- 避免在初始化期间分配重复 IP [#swarmkit/2237](https://github.com/docker/swarmkit/pull/2237)

### 弃用

* 默认禁用传统注册表（v1）[#33629](https://github.com/moby/moby/pull/33629)