---
title: Docker Engine 19.03 发布说明
linkTitle: Engine v19.03
toc_min: 1
toc_max: 2
---

## 19.03.15
2021-02-01

### 安全性

* [CVE-2021-21285](https://github.com/moby/moby/security/advisories/GHSA-6fj5-m822-rqx8) 防止无效镜像导致 docker daemon 崩溃
* [CVE-2021-21284](https://github.com/moby/moby/security/advisories/GHSA-7452-xqpj-6rpc) 锁定文件权限，防止映射后的 root 访问 docker 状态
* 确保在使用 BuildKit 构建时应用 AppArmor 和 SELinux 配置文件

### 客户端

* 在导入上下文之前检查上下文，以减少提取文件逃逸上下文存储的风险

## 19.03.14
2020-12-01

### 安全性

- [CVE-2020-15257](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-15257):
  更新 containerd 静态二进制文件至 v1.3.9 [moby/moby#41731](https://github.com/moby/moby/pull/41731)。
  包管理器应更新 containerd.io 包。

### 构建器

- 现在可以正确解析 beta 版本的 apparmor，防止构建失败 [moby/moby#41542](https://github.com/moby/moby/pull/41542)

### 网络

- 修复 swarmkit 服务持续启动失败时的 panic [moby/moby#41635](https://github.com/moby/moby/pull/41635)

### 运行时

- 返回正确的错误而不是虚假的 -EINVAL [moby/moby#41293](https://github.com/moby/moby/pull/41293)

### 无根模式

- 锁定状态目录以防止被 systemd-tmpfiles 自动清理 [moby/moby#41635](https://github.com/moby/moby/pull/41635)
- dockerd-rootless.sh: 支持新的 containerd shim socket 路径约定 [moby/moby#41557](https://github.com/moby/moby/pull/41557)

### 日志

- gcplogs: 修复内存/连接泄漏 [moby/moby#41522](https://github.com/moby/moby/pull/41522)
- awslogs: 支持 AWS imdsv2 [moby/moby#41494](https://github.com/moby/moby/pull/41494)

## 19.03.13
2020-09-16

### 构建器

- buildkit: 修复缓存逻辑中的 nil 解引用 [moby/moby#41279](https://github.com/moby/moby/pull/41279)
- buildkit: 在 COPY/ADD 期间将 Unix 套接字视为常规文件 [moby/moby#41269](https://github.com/moby/moby/pull/41269)
- buildkit: 在计算中忽略系统和安全 xattrs，确保无论 SELinux 环境如何都能保持一致的 COPY 缓存 [moby/moby#41222](https://github.com/moby/moby/pull/41222)
- buildkit: 使 `--cache-from` 行为更可靠 [moby/moby#41222](https://github.com/moby/moby/pull/41222)
- buildkit: 修复导出缓存时的无限循环导致 CPU 占用问题 [moby/moby#41185](https://github.com/moby/moby/pull/41185)

### 客户端

- 升级 Golang 至 1.13.15 [docker/cli#2674](https://github.com/docker/cli/pull/2674)
- 修复配置文件权限问题（~/.docker/config.json）[docker/cli#2631](https://github.com/docker/cli/pull/2631)
- build: 修复零高度终端上的 panic [docker/cli#2719](https://github.com/docker/cli/pull/2719)
- windows: 修复控制台中换行符的潜在问题 [docker/cli#2623](https://github.com/docker/cli/pull/2623)

### 网络

- 清理失败时的网络沙箱 [moby/moby#41081](https://github.com/moby/moby/pull/41081)
- 通过转发截止日期相关错误给用户来修复浅显的错误消息 [moby/moby#41312](https://github.com/moby/moby/pull/41312)
- 修复 netns 文件描述符泄漏 [moby/moby#41287](https://github.com/moby/moby/41287)

### 无根模式

- 修复端口转发器资源泄漏 [moby/moby#41277](https://github.com/moby/moby/pull/41277)

### 运行时

- 升级 Golang 至 1.13.15 [moby/moby#41334](https://github.com/moby/moby/pull/41334)
- 更新至 containerd 1.3.7 [moby/moby#40408](https://github.com/moby/moby/pull/40408)

### Windows

- 修复使用 servercore 镜像时 Windows 容器启动缓慢的问题 [moby/moby#41192](https://github.com/moby/moby/pull/41192)

## 19.03.12
2020-06-18

### 客户端

- 修复阻止从注册表注销的错误，当使用多个配置文件时（例如 Windows 与 WSL2 使用 Docker Desktop）[docker/cli#2592](https://github.com/docker/cli/pull/2592)
- 修复阻止读取上下文元数据的回归问题 [docker/cli#2586](https://github.com/docker/cli/pull/2586)
- 升级 Golang 至 1.13.12 [docker/cli#2575](https://github.com/docker/cli/pull/2575)

### 网络

- 修复阻止 daemon 在 systemd-nspawn 环境中启动的回归问题 [moby/moby#41124](https://github.com/moby/moby/pull/41124) [moby/libnetwork#2567](https://github.com/moby/libnetwork/pull/2567)
- 修复 swarm 中创建 overlay 网络的重试逻辑 [moby/moby#41124](https://github.com/moby/moby/pull/41124) [moby/libnetwork#2565](https://github.com/moby/libnetwork/pull/2565)

### 运行时

- 升级 Golang 至 1.13.12 [moby/moby#41082](https://github.com/moby/moby/pull/41082)


## 19.03.11
2020-06-01

### 网络

禁用 IPv6 路由器广告以防止地址欺骗。[CVE-2020-13401](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-13401)

**描述**

在 Docker 默认配置中，容器网络接口是到主机的虚拟以太网链路（veth 接口）。
在这种配置中，能够以 root 身份在容器中运行进程的攻击者可以使用 `CAP_NET_RAW` 能力（在默认配置中存在）向主机发送和接收任意数据包。

如果 IPv6 在主机上没有完全禁用（通过 `ipv6.disable=1` 在内核命令行中），它将要么未配置，要么在某些接口上配置，但很可能 ipv6 转发被禁用，即 `/proc/sys/net/ipv6/conf//forwarding == 0`。同时默认情况下，`/proc/sys/net/ipv6/conf//accept_ra == 1`。这两个 sysctl 的组合意味着主机接受路由器广告并使用它们配置 IPv6 栈。

通过从容器发送"恶意"路由器广告，攻击者可以重新配置主机，将主机的部分或全部 IPv6 流量重定向到受攻击者控制的容器。

即使之前没有 IPv6 流量，如果 DNS 返回 A（IPv4）和 AAAA（IPv6）记录，许多 HTTP 库会首先尝试通过 IPv6 连接，然后回退到 IPv4，这给了攻击者机会。
如果主机恰好有像去年 apt 中的 RCE 漏洞（CVE-2019-3462），攻击者现在可以提升到主机。

由于 Docker 容器默认情况下不存在 `CAP_NET_ADMIN`，攻击者无法配置他们想要中间人攻击的 IP，无法使用 iptables 进行 NAT 或 REDIRECT 流量，也无法使用 `IP_TRANSPARENT`。
然而，攻击者仍然可以使用 `CAP_NET_RAW` 并在用户空间实现 tcp/ip 栈。

参见 [kubernetes/kubernetes#91507](https://github.com/kubernetes/kubernetes/issues/91507) 了解相关问题。

## 19.03.10
2020-05-29

### 客户端
- 修复与旧版引擎的版本协商。[docker/cli#2538](https://github.com/docker/cli/pull/2538)
- 避免通过主机名设置 SSH 标志。[docker/cli#2560](https://github.com/docker/cli/pull/2560)
- 修复 DOCKER_CLI_EXPERIMENTAL 无效时的 panic。[docker/cli#2558](https://github.com/docker/cli/pull/2558)
- 通过升级 Go 至 1.13.11 避免在 s390x 上的潜在 panic。[docker/cli#2532](https://github.com/docker/cli/pull/2532)

### 网络
- 修复 DNS 回退回归。[moby/moby#41009](https://github.com/moby/moby/pull/41009)

### 运行时
- 通过升级 Go 至 1.13.11 避免在 s390x 上的潜在 panic。[moby/moby#40978](https://github.com/moby/moby/pull/40978)

### 打包
- 修复 ARM64 上的 ARM 构建。[moby/moby#41027](https://github.com/moby/moby/pull/41027)

## 19.03.9
2020-05-14

### 构建器
- buildkit: 修复并行构建多个镜像时的并发 map 写入 panic。[moby/moby#40780](https://github.com/moby/moby/pull/40780)
- buildkit: 修复在使用 userns 时阻止在阶段间 chown 非 root 拥有文件的问题。[moby/moby#40955](https://github.com/moby/moby/pull/40955)
- 避免在 Windows 上创建不相关的临时文件。[moby/moby#40877](https://github.com/moby/moby/pull/40877)

### 客户端
- 修复单字符卷的 panic。[docker/cli#2471](https://github.com/docker/cli/pull/2471)
- 延迟 daemon 功能检测以避免简单命令的长时间超时。[docker/cli#2442](https://github.com/docker/cli/pull/2442)
- docker context inspect 在 Windows 上现在更快了。[docker/cli#2516](https://github.com/docker/cli/pull/2516)
- 升级 Golang 至 1.13.10。[docker/cli#2431](https://github.com/docker/cli/pull/2431)
- 升级 gopkg.in/yaml.v2 至 v2.2.8。[docker/cli#2470](https://github.com/docker/cli/pull/2470)

### 日志
- 避免由于关闭已关闭的日志文件而导致容器日志无法轮转的情况。[moby/moby#40921](https://github.com/moby/moby/pull/40921)

### 网络
- 修复重启时的潜在 panic。[moby/moby#40809](https://github.com/moby/moby/pull/40809)
- 为默认 bridge 子网字段分配正确的网络值。[moby/moby#40565](https://github.com/moby/moby/pull/40565)

### 运行时
- 修复在 /etc/subuid 和 /etc/subgid 中创建带有 UID 的命名空间时 docker 崩溃的问题。[moby/moby#40562](https://github.com/moby/moby/pull/40562)
- 改进 ARM 平台匹配。[moby/moby#40758](https://github.com/moby/moby/pull/40758)
- overlay2: 显示后备文件系统。[moby/moby#40652](https://github.com/moby/moby/pull/40652)
- 更新 CRIU 至 v3.13 "Silicon Willet"。[moby/moby#40850](https://github.com/moby/moby/pull/40850)
- 仅在成功回退到注册表 v2 schema1 时显示弃用警告，而不是任何注册表错误。[moby/moby#40681](https://github.com/moby/moby/pull/40681)
- 在 Windows 上为日志文件使用 FILE_SHARE_DELETE。[moby/moby#40563](https://github.com/moby/moby/pull/40563)
- 升级 Golang 至 1.13.10。[moby/moby#40803](https://github.com/moby/moby/pull/40803)

### 无根模式
- 现在 rootlesskit-docker-proxy 在暴露特权端口时返回详细的错误消息。[moby/moby#40863](https://github.com/moby/moby/pull/40863)
- 支持 /etc/subuid 和 /etc/subgid 中的数字 ID。[moby/moby#40951](https://github.com/moby/moby/pull/40951)

### 安全性
- apparmor: 为 userns 添加缺失的规则。[moby/moby#40564](https://github.com/moby/moby/pull/40564)
- SElinux: 修复在重新标记时未检测到 ENOTSUP 错误的问题。[moby/moby#40946](https://github.com/moby/moby/pull/40946)

### Swarm
- 增加 logger 的补充速率以避免在服务日志上挂起。[moby/moby#40628](https://github.com/moby/moby/pull/40628)
- 修复单个 swarm 管理员在重启后卡在 Down 状态的问题。[moby/moby#40831](https://github.com/moby/moby/pull/40831)
- tasks.db 不再无限增长。[moby/moby#40831](https://github.com/moby/moby/pull/40831)

## 19.03.8
2020-03-10

### 运行时

- 改进对 [CVE-2019-14271](https://nvd.nist.gov/vuln/detail/CVE-2019-14271) 的缓解，针对某些 nscd 配置。

## 19.03.7
2020-03-03

### 构建器

- builder-next: 修复边界情况下的死锁问题。[moby/moby#40557](https://github.com/moby/moby/pull/40557)

### 运行时

* overlay: 移除 modprobe 执行。[moby/moby#40462](https://github.com/moby/moby/pull/40462)
* selinux: 在设置文件标签时显示更好的错误消息。[moby/moby#40547](https://github.com/moby/moby/pull/40547)
* 加速初始统计信息收集。[moby/moby#40549](https://github.com/moby