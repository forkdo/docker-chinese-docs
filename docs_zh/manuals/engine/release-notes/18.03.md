---
title: Docker Engine 18.03 发布说明
linkTitle: Engine v18.03
toc_min: 1
toc_max: 2
---

## 18.03.1-ce
2018-04-26

### 客户端

- 修复合并包含网络的 compose 文件时的错误 [docker/cli#983](https://github.com/docker/cli/pull/983)
* 修复使用 `--force` 更新服务后 docker stack deploy 重新部署服务的问题 [docker/cli#963](https://github.com/docker/cli/pull/963)
* 修复 docker version 输出对齐问题 [docker/cli#965](https://github.com/docker/cli/pull/965)

### 运行时

- 修复 AppArmor 配置未应用到 `docker exec` 进程的问题 [moby/moby#36466](https://github.com/moby/moby/pull/36466)
- 不要对插件挂载切片进行排序 [moby/moby#36711](https://github.com/moby/moby/pull/36711)
- 守护进程/集群：在配置期间处理部分附件条目 [moby/moby#36769](https://github.com/moby/moby/pull/36769)
* 将 Golang 升级到 1.9.5 [moby/moby#36779](https://github.com/moby/moby/pull/36779) [docker/cli#986](https://github.com/docker/cli/pull/986)
- 守护进程/统计：更健壮的 CPU 采样 [moby/moby#36519](https://github.com/moby/moby/pull/36519)
* Containerd：更新到 1.0.3 版本 [moby/moby#36749](https://github.com/moby/moby/pull/36749)
- 修复 Windows 层在写入失败时的泄漏问题 [moby/moby#36728](https://github.com/moby/moby/pull/36728)
* 不要使容器挂载不可绑定 [moby/moby#36768](https://github.com/moby/moby/pull/36768)
- 修复守护进程重启后容器导出时的守护进程崩溃问题 [moby/moby/36586](https://github.com/moby/moby/pull/36586)
- 修复在认证错误时摘要缓存被移除的问题 [moby/moby#36509](https://github.com/moby/moby/pull/36509)
- 确保在失败时移除插件容器 [moby/moby#36715](https://github.com/moby/moby/pull/36715)
- 复制：避免使用授权插件时占用所有系统内存 [moby/moby#36595](https://github.com/moby/moby/pull/36595)
- 放宽部分 libcontainerd 客户端锁定 [moby/moby#36848](https://github.com/moby/moby/pull/36848)
- 更新 `hcsshim` 到 v0.6.10 以解决 [CVE-2018-8115](https://portal.msrc.microsoft.com/en-us/security-guidance/advisory/CVE-2018-8115)

### Swarm 模式

* 将 raft 选举滴答增加到心跳滴答的 10 倍 [moby/moby#36672](https://github.com/moby/moby/pull/36672)

### 网络

* 从服务中优雅地移除负载均衡器端点 [docker/libnetwork#2112](https://github.com/docker/libnetwork/pull/2112)
* 在 ServFail 时重试其他外部 DNS 服务器 [docker/libnetwork#2121](https://github.com/docker/libnetwork/pull/2121)
* 改进网桥网络隔离规则的可扩展性 [docker/libnetwork#2117](https://github.com/docker/libnetwork/pull/2117)
* 允许更大的预设属性值，不要覆盖 [docker/libnetwork#2124](https://github.com/docker/libnetwork/pull/2124)
* 防止在调用 `changeNodeState` 时并发读写导致的崩溃 [docker/libnetwork#2136](https://github.com/docker/libnetwork/pull/2136)

## 18.03.0-ce
2018-03-21

### 构建器

* 切换到 -buildmode=pie [moby/moby#34369](https://github.com/moby/moby/pull/34369)
* 允许 Dockerfile 位于构建上下文之外 [docker/cli#886](https://github.com/docker/cli/pull/886)
* 构建器：修复从 tar 构建时错误的缓存命中 [moby/moby#36329](https://github.com/moby/moby/pull/36329)
- 修复多阶段构建中文件泄漏到其他镜像的问题 [moby/moby#36338](https://github.com/moby/moby/pull/36338)

### 客户端

* 简化 compose types.Config 的编组 [docker/cli#895](https://github.com/docker/cli/pull/895)
+ 添加部署时支持多个 compose 文件 [docker/cli#569](https://github.com/docker/cli/pull/569)
- 修复 Kubernetes 堆栈标志的问题 [docker/cli#831](https://github.com/docker/cli/pull/831)
- 修复 Kubernetes 的堆栈编组 [docker/cli#890](https://github.com/docker/cli/pull/890)
- 修复并简化服务环境变量、挂载和标签的 bash 补全 [docker/cli#682](https://github.com/docker/cli/pull/682)
- 修复 `docker ps` 的 `before` 和 `since` 过滤器 [moby/moby#35938](https://github.com/moby/moby/pull/35938)
- 修复 `--label-file` 的奇怪行为 [docker/cli#838](https://github.com/docker/cli/pull/838)
- 修复在不支持平台上的 defaultCredentialStore() 编译 [docker/cli#872](https://github.com/docker/cli/pull/872)
* 改进并修复镜像的 bash 补全 [docker/cli#717](https://github.com/docker/cli/pull/717)
+ 添加对绑定挂载中空源文件的检查 [docker/cli#824](https://github.com/docker/cli/pull/824)
- 修复客户端中从环境变量获取 TLS 的问题 [moby/moby#36270](https://github.com/moby/moby/pull/36270)
* 当配置了特定注册表的凭据助手时，docker build 现在运行得更快 [docker/cli#840](https://github.com/docker/cli/pull/840)
* 使用 `disable`、`enable`、`install` 和 `remove` 更新事件过滤器 zsh 补全 [docker/cli#372](https://github.com/docker/cli/pull/372)
* 在 inspect 调用中传入空 ID 时产生错误 [moby/moby#36144](https://github.com/moby/moby/pull/36144)
* 为 k8s 控制器编组版本 [docker/cli#891](https://github.com/docker/cli/pull/891)
* 为与插件后端的 HTTP 客户端通信设置非零超时 [docker/cli#883](https://github.com/docker/cli/pull/883)
+ 为 --tls 选项添加 DOCKER_TLS 环境变量 [docker/cli#863](https://github.com/docker/cli/pull/863)
+ 为 secrets/configs 添加 --template-driver 选项 [docker/cli#896](https://github.com/docker/cli/pull/896)
+ 将 `docker trust` 命令移出实验性 [docker/cli#934](https://github.com/docker/cli/pull/934) [docker/cli#935](https://github.com/docker/cli/pull/935) [docker/cli#944](https://github.com/docker/cli/pull/944)

### 日志

* AWS 日志 - 不要向最大大小的事件添加新行 [moby/moby#36078](https://github.com/moby/moby/pull/36078)
* 在插件加载后移动日志验证器逻辑 [moby/moby#36306](https://github.com/moby/moby/pull/36306)
* 支持 Splunk 日志驱动中的代理 [moby/moby#36220](https://github.com/moby/moby/pull/36220)
- 修复空日志时的日志尾部问题 [moby/moby#36305](https://github.com/moby/moby/pull/36305)

### 网络

* Libnetwork 重新引入 [moby/moby#36137](https://github.com/moby/moby/pull/36137)
- 修复退出时 Memberlist 重新引入导致的死锁 [docker/libnetwork#2040](https://github.com/docker/libnetwork/pull/2040)
* 修复用户指定的 ndots 选项 [docker/libnetwork#2065](https://github.com/docker/libnetwork/pull/2065)
- 修复 Windows 上使用 ContainerID 而不是 SandboxID [docker/libnetwork#2010](https://github.com/docker/libnetwork/pull/2010)
* 验证 NetworkingConfig 以确保 EndpointSettings 不为 nil [moby/moby#36077](https://github.com/moby/moby/pull/36077)
- 修复 `DockerNetworkInternalMode` 问题 [moby/moby#36298](https://github.com/moby/moby/pull/36298)
- 修复可附加网络附件中的竞态条件 [moby/moby#36191](https://github.com/moby/moby/pull/36191)
- 修复 AArch64 上 `InspectNetwork` 的超时问题 [moby/moby#36257](https://github.com/moby/moby/pull/36257)
* 部分覆盖 ID 缺少详细信息的 verbose 信息 [moby/moby#35989](https://github.com/moby/moby/pull/35989)
* 更新 `FindNetwork` 以解决网络名称重复问题 [moby/moby#30897](https://github.com/moby/moby/pull/30897)
* 禁止附加入口网络 [docker/swarmkit#2523](https://github.com/docker/swarmkit/pull/2523)
- 防止隐式移除入口网络 [moby/moby#36538](https://github.com/moby/moby/pull/36538)
- 修复 Windows 上陈旧的 HNS 端点 [moby/moby#36603](https://github.com/moby/moby/pull/36603)
- 修复重复 IP 地址的 IPAM 问题 [docker/libnetwork#2104](https://github.com/docker/libnetwork/pull/2104) [docker/libnetwork#2105](https://github.com/docker/libnetwork/pull/2105)

### 运行时

* 为 Windows 启用 HotAdd [moby/moby#35414](https://github.com/moby/moby/pull/35414)
* LCOW：修复 hotRemoveVHDs 中的死锁 [moby/moby#36114](https://github.com/moby/moby/pull/36114)
* LCOW：如果只有一层则常规挂载 [moby/moby#36052](https://github.com/moby/moby/pull/36052)
* 移除临时环境变量 LCOW_API_PLATFORM_IF_OMITTED [moby/moby#36269](https://github.com/moby/moby/pull/36269)
* 重新引入 Microsoft/opengcs @ v0.3.6 [moby/moby#36108](https://github.com/moby/moby/pull/36108)
- 修复 ExitCode 和 PID 未在 Task.Status.ContainerStatus 中显示的问题 [moby/moby#36150](https://github.com/moby/moby/pull/36150)
- 修复插件扫描器过深的问题 [moby/moby#36119](https://github.com/moby/moby/pull/36119)
* 不要使图形驱动器的家目录为私有挂载 [moby/moby#36047](https://github.com/moby/moby/pull/36047)
* 在 zfs/btrfs 清理时不要递归卸载 [moby/moby#36237](https://github.com/moby/moby/pull/36237)
* 如果层不存在则不要恢复镜像 [moby/moby#36304](https://github.com/moby/moby/pull/36304)
* 调整模板化 configs/secrets 的最小 API 版本 [moby/moby#36366](https://github.com/moby/moby/pull/36366)
* 将 containerd 升级到 1.0.2 (cfd04396dc68220d1cecbe686a6cc3aa5ce3667c) [moby/moby#36308](https://github.com/moby/moby/pull/36308)
* 将 Golang 升级到 1.9.4 [moby/moby#36243](https://github.com/moby/moby/pull/36243)
* 确保守护进程根目录在关闭时卸载 [moby/moby#36107](https://github.com/moby/moby/pull/36107)
* 更新 runc 到 6c55f98695e902427906eed2c799e566e3d3dfb5 [moby/moby#36222](https://github.com/moby/moby/pull/36222)
- 修复守护进程重启时的容器清理问题 [moby/moby#36249](https://github.com/moby/moby/pull/36249)
* 支持 SCTP 端口映射（将 API 升级到 v1.37） [moby/moby#33922](https://github.com/moby/moby/pull/33922)
* 支持 SCTP 端口映射 [docker/cli#278](https://github.com/docker/cli/pull/278)
- 修复 ContainerConfig 中的 Volumes 属性定义 [moby/moby#35946](https://github.com/moby/moby/pull/35946)
* 升级 moby 及其依赖 [docker/cli#829](https://github.com/docker/cli/pull/829)
* C.RWLayer：使用前检查 nil [moby/moby#36242](https://github.com/moby/moby/pull/36242)
+ 添加 `REMOVE` 和 `ORPHANED` 到 TaskState [moby/moby#36146](https://github.com/moby/moby/pull/36146)
- 修复使用 `IsErrNotFound` 和 `IsErrNotImplemented` 检测 `ContainerStatPath`、`CopyFromContainer` 和 `CopyToContainer` 方法的错误 [moby/moby#35979](https://github.com/moby/moby/pull/35979)
+ 添加 integration/internal/container 辅助包 [moby/moby#36266](https://github.com/moby/moby/pull/36266)
+ 添加规范导入路径 [moby/moby#36194](https://github.com/moby/moby/pull/36194)
+ 添加/使用 container.Exec() 到集成 [moby/moby#36326](https://github.com/moby/moby/pull/36326)
- 修复 "--node-generic-resource" 单复数问题 [moby/moby#36125](https://github.com/moby/moby/pull/36125)
* Daemon.cleanupContainer：释放时将容器 RWLayer 置空 [moby/moby#36160](https://github.com/moby/moby/pull/36160)
* Daemon：将 `--oom-kill-disable` 选项传递给 containerd [moby/moby#36201](https://github.com/moby/moby/pull/36201)
* 当有绑定端口且网络模式为主机时显示警告消息 [moby/moby#35510](https://github.com/moby/moby/pull/35510)
* 在 containerd 重启时刷新 containerd 远程 [moby/moby#36173](https://github.com/moby/moby/pull/36173)
* 设置守护进程根目录使用共享传播 [moby/moby#36096](https://github.com/moby/moby/pull/36096)
* 递归卸载的优化 [moby/moby#34379](https://github.com/moby/moby/pull/34379)
* 在运行时执行插件挂载 [moby/moby#35829](https://github.com/moby/moby/pull/35829)
* Graphdriver：修复 RefCounter 内存泄漏 [moby/moby#36256](https://github.com/moby/moby/pull/36256)
* 使用 continuity fs 包进行卷复制 [moby/moby#36290](https://github.com/moby/moby/pull/36290)
* 使用 proc/exe 进行重新执行 [moby/moby#36124](https://github.com/moby/moby/pull/36124)
+ 为模板化 secrets 和 configs 添加 API 支持 [moby/moby#33702](https://github.com/moby/moby/pull/33702) 和 [moby/moby#36366](https://github.com/moby/moby/pull/36366)
* 使用 rslave 传播从守护进程根目录的挂载 [moby/moby#36055](https://github.com/moby/moby/pull/36055)
+ 添加 /proc/keys 到屏蔽路径 [moby/moby#36368](https://github.com/moby/moby/pull/36368)
* 升级 Runc 到 1.0.0-rc5 [moby/moby#36449](https://github.com/moby/moby/pull/36449)
- 修复大端架构上的 `runc exec` [moby/moby#36449](https://github.com/moby/moby/pull/36449)
* 当未提供挂载命名空间时使用 chroot [moby/moby#36449](https://github.com/moby/moby/pull/36449)
- 修复 systemd 切片扩展以便 cAdvisor 可以消费 [moby/moby#36449](https://github.com/moby/moby/pull/36449)
- 修复以错误 uid/gid 挂载的设备 [moby/moby#36449](https://github.com/moby/moby/pull/36449)
- 修复 IPC 私有挂载的只读容器 `/dev/shm` 为只读 [moby/moby#36526](https://github.com/moby/moby/pull/36526)

### Swarm 模式

* 用 PKCS#8 PEMs 替换 EC 私钥 [docker/swarmkit#2246](https://github.com/docker/swarmkit/pull/2246)
* 修复空 EndpointSpec 的 IP 重叠问题 [docker/swarmkit #2505](https://github.com/docker/swarmkit/pull/2505)
* 添加对 SCTP 端口映射的支持 [docker/swarmkit#2298](https://github.com/docker/swarmkit/pull/2298)
* 如果仅更改了放置约束且已满足，则不要重新调度任务 [docker/swarmkit#2496](https://github.com/docker/swarmkit/pull/2496)
* 确保任务收割器 stopChan 最多关闭一次 [docker/swarmkit #2491](https://github.com/docker/swarmkit/pull/2491)
* 同步修复 [docker/swarmkit#2495](https://github.com/docker/swarmkit/pull/2495)
* 如果流未实现，添加重试消息发送的日志消息 [docker/swarmkit#2483](https://github.com/docker/swarmkit/pull/2483)
* 调度器、心跳的会话、节点事件的调试日志 [docker/swarmkit#2486](https://github.com/docker/swarmkit/pull/2486)
+ 添加 swarm 类型到 bash 补全事件类型过滤器 [docker/cli#888](https://github.com/docker/cli/pull/888)
- 修复网络检查未显示 swarm 范围网络创建时间的问题 [moby/moby#36095](https://github.com/moby/moby/pull/36095)