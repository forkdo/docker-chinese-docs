---
description: 介绍 Docker Engine swarm 模式的几个核心概念
keywords: docker, 容器, 集群, swarm 模式, docker engine
title: Swarm 模式核心概念
---

本文档介绍 Docker Engine 1.12 中内嵌的集群管理和编排功能所涉及的一些独特概念。

## 什么是 Swarm？

Docker Engine 中的集群管理和编排功能基于 [swarmkit](https://github.com/docker/swarmkit/) 构建。swarmkit 是一个独立的项目，实现了 Docker 的编排层，并被 Docker 直接使用。

一个 swarm 由多个 Docker 主机组成，这些主机以 Swarm 模式运行，充当管理节点（manager）以管理成员身份和任务委派，以及工作节点（worker）以运行 [swarm 服务](#services-and-tasks)。一个给定的 Docker 主机可以是管理节点、工作节点，或同时承担两种角色。当你创建一个服务时，你需要定义其期望状态——副本数量、可用的网络和存储资源、服务对外暴露的端口等。Docker 会努力维持这种期望状态。例如，如果一个工作节点变得不可用，Docker 会将该节点的任务调度到其他节点上。任务（task）是一个正在运行的容器，它是 swarm 服务的一部分，并由 swarm 管理节点管理，与独立容器相对。

Swarm 服务相对于独立容器的一个关键优势是，你可以修改服务的配置，包括其连接的网络和卷，而无需手动重启服务。Docker 会更新配置，停止使用过时配置的服务任务，并创建符合期望配置的新任务。

当 Docker 以 Swarm 模式运行时，你仍然可以在参与 swarm 的任何 Docker 主机上运行独立容器，以及 swarm 服务。独立容器和 swarm 服务之间的一个关键区别是，只有 swarm 管理节点可以管理 swarm，而独立容器可以在任何守护进程中启动。Docker 守护进程可以作为管理节点、工作节点或两者兼具参与 swarm。

与你可以使用 [Docker Compose](/manuals/compose/_index.md) 来定义和运行容器一样，你也可以定义和运行 [Swarm 服务栈](services.md)。

继续阅读以了解与 Docker swarm 服务相关的概念，包括节点、服务、任务和负载均衡。

## 节点

节点是参与 swarm 的 Docker 引擎实例。你也可以将其视为 Docker 节点。你可以在单个物理计算机或云服务器上运行一个或多个节点，但生产环境的 swarm 部署通常包括分布在多个物理和云机器上的 Docker 节点。

要将应用程序部署到 swarm，你需要向管理节点提交服务定义。管理节点将称为 [任务](#services-and-tasks) 的工作单元分派给工作节点。

管理节点还执行维护 swarm 期望状态所需的编排和集群管理功能。管理节点选择一个领导者来执行编排任务。

工作节点接收并执行来自管理节点分派的任务。默认情况下，管理节点也作为工作节点运行服务，但你可以将其配置为仅执行管理任务，成为仅管理节点。每个工作节点上运行一个代理，报告其被分配的任务状态。工作节点向管理节点通知其分配任务的当前状态，以便管理节点能够维护每个工作节点的期望状态。

## 服务和任务

服务是定义在管理节点或工作节点上执行的任务。它是 swarm 系统的核心结构，也是用户与 swarm 交互的主要入口点。

当你创建一个服务时，你需要指定使用哪个容器镜像以及在运行的容器内执行哪些命令。

在复制服务模型中，swarm 管理节点根据你在期望状态中设置的规模在节点之间分发特定数量的副本任务。

对于全局服务，swarm 在集群中每个可用节点上为该服务运行一个任务。

任务承载一个 Docker 容器及其内部要执行的命令。它是 swarm 的原子调度单元。管理节点根据服务规模中设置的副本数量将任务分配给工作节点。一旦任务被分配给节点，它就不能移动到另一个节点。它只能在被分配的节点上运行或失败。

## 负载均衡

Swarm 管理节点使用入口（ingress）负载均衡来向 swarm 外部公开你希望对外可用的服务。Swarm 管理节点可以自动为服务分配一个发布端口，或者你可以为服务配置一个发布端口。你可以指定任何未使用的端口。如果你不指定端口，swarm 管理节点会为服务在 30000-32767 范围内分配一个端口。

外部组件（如云负载均衡器）可以通过集群中任何节点的发布端口访问该服务，无论该节点当前是否正在运行该服务的任务。Swarm 中的所有节点都将入口连接路由到正在运行的任务实例。

Swarm 模式有一个内部 DNS 组件，自动为 swarm 中的每个服务分配 DNS 条目。Swarm 管理节点使用内部负载均衡，根据服务的 DNS 名称在集群内的服务之间分发请求。

## 下一步

* 阅读 [Swarm 模式概述](index.md)。
* 开始 [Swarm 模式教程](swarm-tutorial/_index.md)。